<!doctype html><html><head><title>Zephyr笔记 :: 闲一文档</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><meta name=revised content="2020-12-15T06:46:07 UTC"><meta name=description content><title>Zephyr笔记 :: 闲一文档</title><link rel="shortcut icon" href=/wedoc/images/favicon.png type=image/x-icon><link rel=stylesheet href=https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css integrity=sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.css><script src=https://code.jquery.com/jquery-3.5.1.min.js></script><link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel=stylesheet><link rel=stylesheet type=text/css href=https://xianii.gitee.io/wedoc/sass/layout.css><link rel=stylesheet type=text/css href=https://xianii.gitee.io/wedoc/css/style.main.css><link rel=stylesheet type=text/css href=https://xianii.gitee.io/wedoc/css/style.menu.css><link rel=stylesheet type=text/css href=https://xianii.gitee.io/wedoc/sass/shortcodes/notice.css><link rel=stylesheet type=text/css href=https://xianii.gitee.io/wedoc/sass/shortcodes/tabs.css><link rel=stylesheet type=text/css href=https://xianii.gitee.io/wedoc/sass/shortcodes/panel.css><link rel=stylesheet type=text/css href=https://xianii.gitee.io/wedoc/sass/shortcodes/columns.css><link rel=stylesheet type=text/css href=https://xianii.gitee.io/wedoc/sass/shortcodes/children.css><link rel=stylesheet type=text/css href=https://xianii.gitee.io/wedoc/sass/shortcodes/attachments.css><link rel=stylesheet type=text/css href=https://xianii.gitee.io/wedoc/sass/shortcodes/alert.css><link rel=stylesheet type=text/css href=/wedoc/css/docport.css><script src=/wedoc/js/docport.js></script><script type=text/javascript>var baseurl="https:\/\/xianii.gitee.io\/wedoc\/";</script><script>MathJax={tex:{inlineMath:[['$','$']],displayMath:[["$$","$$"]]},svg:{fontCache:'global'}};</script><script type=text/javascript id=MathJax-script async src=https://cdn.bootcdn.net/ajax/libs/mathjax/3.0.5/es5/tex-svg.js></script></head><body data-url=/wedoc/notes/zephyrnote/><style type=text/css>#debug{display:-webkit-box;display:-ms-flexbox;display:flex;line-height:3.5rem;margin-bottom:.35rem;padding:0 2rem;position:fixed;left:0;right:0;top:0;top:0;min-height:150px;background-color:#fff;border:3px solid red;z-index:10000;word-wrap:all;overflow:auto}</style><header><div><div class=burger><a href=javascript:void(0); style=font-size:15px onclick="$('article > aside').toggleClass('responsive')">&#9776;</a></div><div><a class=baselink href=https://xianii.gitee.io/wedoc/>闲一文档</a></div></div></header><article><aside><div class=search><div class=searchbox><input data-search-input id=search-by type=text placeholder="Type to search..."></div><script type=text/javascript src=/wedoc/vendor/lunr/lunr.min.js></script><script type=text/javascript src=/wedoc/vendor/auto-complete/auto-complete.js></script><link href=/wedoc/vendor/auto-complete/auto-complete.css rel=stylesheet><script type=text/javascript>var baseurl="https:\/\/xianii.gitee.io\/wedoc\/";</script><script type=text/javascript src=/wedoc/js/search.js></script></div><div id=close_menu><a href=javascript:void(0); style=font-size:15px onclick="$('article > aside').toggleClass('responsive')"><i class="fa fa-lg fa-times"></i></a></div><ul class=menu><li data-nav-id=https://xianii.gitee.io/wedoc/docs/ class="dd-item haschildren
item_level_$level"><i class="fas fa-chevron-right ddexp"></i><a href=/wedoc/docs/>开发环境</a><ul><li data-nav-id=https://xianii.gitee.io/wedoc/docs/tools/ class="dd-item
item_level_$level"><a href=/wedoc/docs/tools/>工具链安装</a></li></ul></li><li data-nav-id=https://xianii.gitee.io/wedoc/notes/ class="dd-item parent active
item_level_$level"><a href=/wedoc/notes/>指导笔记</a></li><li data-nav-id=https://xianii.gitee.io/wedoc/usage/ class="dd-item
item_level_$level"><a href=/wedoc/usage/>模板用例</a></li></ul></aside><section class=page><nav id=ariane aria-label=breadcrumb><ol class=ariane><li><a class=text-link href=https://xianii.gitee.io/wedoc/>Home</a></li><li><a class=text-link href=/wedoc/notes/>指导笔记</a></li><li class=active>Zephyr笔记</li></ol></nav><h1>指导笔记<span>Zephyr笔记</span></h1><nav class=subpages><li><a title=$pagetitle href=/wedoc/notes/nrf52note/>nRF52开发笔记</a></li><li class=active><a title=$pagetitle href=/wedoc/notes/zephyrnote/>Zephyr笔记</a></li><li><a title=$pagetitle href=/wedoc/notes/memo/>备忘杂记</a></li></nav><div class=jump-to-section><span onclick="$h=$(this);$h.next('nav').slideToggle(100,function(){$h.children('i').attr('class',function(){return $h.next('nav').is(':visible')?'fas fa-chevron-down':'fas fa-chevron-right';});});"><span class="fas fa-align-right"></span>Jump to Section
<i class="fas fa-chevron-right"></i></span><nav id=TableOfContents><ul><li><a href=#0-环境安装>0. 环境安装</a><ul><li><a href=#烧录工具>烧录工具</a></li><li><a href=#已知问题>已知问题</a></li></ul></li><li><a href=#编译>编译</a></li><li><a href=#烧录>烧录</a></li><li><a href=#调试>调试</a></li></ul><ul><li><a href=#自定义板子>自定义板子</a></li><li><a href=#外部项目>外部项目</a></li></ul></nav></div><div class=content><div class="notices warning"><p>本笔记编写于 <em>Zephyr:2.4.99</em> | <em>SDK:0.11.4</em></p></div><h1 ref=a-环境搭建>A. 环境搭建</h1><a class=anchor id=a-环境搭建></a><h2 ref=0-环境安装>0. 环境安装</h2><a class=anchor id=0-环境安装></a><p>参照<a href=https://docs.zephyrproject.org/latest/getting_started/index.html>官方文档</a>，在 <code>WSL on windows</code> 和 <code>Ubuntu</code> 系统均成立。</p><h3 ref=烧录工具>烧录工具</h3><a class=anchor id=烧录工具></a><p>一些板子默认的烧录工具为 <code>nrfjprog</code>，访问<a href=https://www.nordicsemi.com/Software-and-tools/Development-Tools/nRF-Command-Line-Tools/Download>nRF Command Line Tools</a>安装</p><p>一些板子默认的烧录工具为 <code>pyocd</code>，如无意外，会在安装依赖时自动安装上。<br>手动则使用 <code>pip3 install pyocd</code> 来安装。安装时，可使用 <code>pip3 install -i &lt;src></code> 指定国内源提升速度。</p><div class="notices info"><p>pip国内源：<br>阿里源: <code>https://mirrors.aliyun.com/pypi/simple/</code><br>清华源: <code>https://pypi.tuna.tsinghua.edu.cn/simple/</code><br>中科大源: <code>https://pypi.mirrors.ustc.edu.cn/simple/</code></p></div><div class="notices primary"><p>Ubuntu 下安装 nrfjprog:<br>Ubuntu 下使用 <code>ln -s &lt;src> &lt;des></code> 命令在 <code>/sbin</code> 创建 <code>nrfjprog</code> 的软链接 <em>(注意 <code>src</code> 应当使用绝对路径)</em>，支持安装 <code>deb</code> 包的系统可以直接使用 <code>sudo dpkg -i &lt;deb></code> 安装</p></div><div class="notices primary"><p>WSL:<br><code>WSL</code> 环境下可能缺少依赖，需要手动安装 <code>sudo apt install libtinfo5 libncurses5</code></p></div><div class="notices success"><p>使用 <code>west init</code> 的包可以拷贝至其他环境，避免重复下载耗费大量时间</p></div><h3 ref=已知问题>已知问题</h3><a class=anchor id=已知问题></a><ol><li><code>west zephyr-export</code> 在 <code>WSL</code> 环境可能无法使用，可以考虑按照官方给出的方式手动编译或者跳过此步。ps. Ubuntu下正常</li><li><span class="badge badge-success">Fixed</span> <del><code>requirements.txt</code> 里缺少 <code>pyelftools</code> 工具，需要手动安装 <code>pip3 install pyelftools</code>，否则最后无法编译。</del></li><li>由于 <code>WSL</code> 无法识别到宿主机的 <code>USB</code>，所以无法在 <code>WSL</code> 环境中烧录</li></ol><p>建议在 Ubuntu 环境下开发，免去许多奇怪的问题。</p><h2 ref=编译>编译</h2><a class=anchor id=编译></a><div class=tabs><input type=radio name=tabs-6 id=tabs-6-0 checked>
<label for=tabs-6-0>nrf52832</label><div class=tab>指定开发板为官方支持开发板 <code>nrf52832_mdk</code>，使用 <code>west</code> 编译官方例程 <code>blinky</code> 如下：<br><code>west build -p auto -b nrf52832_mdk samples/basic/blinky</code></div><input type=radio name=tabs-6 id=tabs-6-1>
<label for=tabs-6-1>nrf52840</label><div class=tab>指定开发板为官方支持开发板 <code>nrf52840dongle_nrf52840</code>，使用 <code>west</code> 编译官方例程 <code>blinky</code>，如下：<br><code>west build -p auto -b nrf52840dongle_nrf52840 samples/basic/blinky</code></div></div><h2 ref=烧录>烧录</h2><a class=anchor id=烧录></a><div class=tabs><input type=radio name=tabs-7 id=tabs-7-0 checked>
<label for=tabs-7-0>nrf52832_mdk</label><div class=tab>默认烧录工具为 <code>pyocd</code>，Ubuntu上可以正常使用 <code>pyocd</code> + <code>cmsis-dap</code> 的组合直接运行 <code>west flash</code> 进行烧录。</div><input type=radio name=tabs-7 id=tabs-7-1>
<label for=tabs-7-1>nrf52840dongle_nrf52840</label><div class=tab>默认烧录工具为 <code>nrfjprog</code>，Ubuntu上可以正常使用 <code>nrfjprog</code> + <code>jlink</code> 的组合直接运行 <code>west flash</code> 进行烧录。</div></div><p><strong>已知问题</strong>：<code>pyocd</code> 识别不到 <code>jlink</code>，可以使用 <code>pyocd</code> + <code>cmsis-dap</code> 或者 <code>nrfjprog</code> + <code>jlink</code> 的组合进行烧录</p><h2 ref=调试>调试</h2><a class=anchor id=调试></a><p>使用 <code>west debug</code> 启动 <code>GDB</code></p><h1 ref=b-自定义>B. 自定义</h1><a class=anchor id=b-自定义></a><h2 ref=自定义板子>自定义板子</h2><a class=anchor id=自定义板子></a><p>参考链接：<a href>https://docs.zephyrproject.org/latest/application/index.html#custom-board-definition</a></p><p>自定义板子有两种方式，一种是放到 <code>zephyr/boards/arch/&lt;board></code> 路径下，一种是放到项目的路径下 <code>&lt;project path>/boards/arch/&lt;board></code></p><p>前者将自定义的板子加入了 <code>zephyr</code> 的 <code>device tree</code>，直接通过 <code>west build -b &lt;board name></code> 命令，<code>west</code> 就能找到板子。</p><p>后者则需要指定板子定义的路径：<br><code>west build -b &lt;board name> -- -DBOARD_ROOT=${PWD}</code></p><h2 ref=外部项目>外部项目</h2><a class=anchor id=外部项目></a><p>以上步骤均是在 <code>zephyr</code> 的目录下面进行操作。离开 <code>zephyr</code> 目录会使得 <code>west</code> 命令找不到自身运行的环境。</p><p>接下来的配置将会使得 <code>west</code> 命令能够在 <code>zephyr</code> 目录外部运行，使得我们的项目目录可以独立出来。</p><p>coming soon&mldr;</p></div><div class=chevrons><a class=next href=/wedoc/usage/ title=模板用例 style=margin-right:0><div><p>Next page</p><label>模板用例</label></div><i class="fas fa-arrow-right" style=font-size:1.7em></i></a></div></section><section class=right-menu><div class=TableOfContents><label><i class="fas fa-align-right"></i>&nbsp;&nbsp;What's on this page</label><nav><ul><li><a href=/wedoc/notes/zephyrnote/>Zephyr笔记</a></li></ul></nav><nav id=TableOfContents><ul><li><a href=#0-环境安装>0. 环境安装</a><ul><li><a href=#烧录工具>烧录工具</a></li><li><a href=#已知问题>已知问题</a></li></ul></li><li><a href=#编译>编译</a></li><li><a href=#烧录>烧录</a></li><li><a href=#调试>调试</a></li></ul><ul><li><a href=#自定义板子>自定义板子</a></li><li><a href=#外部项目>外部项目</a></li></ul></nav></div><div class=Actions><nav><ul></ul></nav></div></section></article><footer><p>&mldr;</p></footer></body></html>